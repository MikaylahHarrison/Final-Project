{% extends "base.html" %}
{% block title %}Student Detail{% endblock %}

{% block content %}

<h2 class="mb-2">{{ student.first_name }} {{ student.last_name }}</h2>
<p class="text-muted mb-4">Class Period: {{ student.period }}</p>
<p><strong>Employability Grade:</strong> {{ 100 + student.infractions | sum(attribute='points') }}%</p>

<div class="mb-3">
    <a href="{{ url_for('students_list') }}" class="btn btn-outline-secondary btn-sm">Back to Students</a>
    <form method="POST" action="{{ url_for('remove_student', student_id=student_id) }}" style="display:inline;">
        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to remove this student?');">
            Remove Student
        </button>
    </form>
</div>

<div class="card p-3 shadow-sm mb-4">
    <h5>Infractions</h5>
    <table class="table table-sm table-bordered mt-3">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Description</th>
                <th>Points</th>
                <th>Remove</th>
            </tr>
        </thead>
        <tbody>
            {% for infraction in student.infractions %}
            <tr>
                <td>{{ infraction.timestamp }}</td>
                <td>{{ infraction.description }}</td>
                <td>{{ infraction.points }}</td>
                <td>
                    <form method="POST" action="{{ url_for('remove_infraction', student_id=student_id, infraction_index=loop.index0) }}">
                        <button type="submit" class="btn btn-sm btn-danger">X</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="text-muted">No infractions yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="row g-4">
    <div class="col-md-4">
        <h5>Quick Actions</h5>
        <form method="POST">
            {% for button in quick_buttons %}
            <button type="submit" name="quick_label" value="{{ button.label }}" class="btn btn-outline-primary w-100 mb-2">
                {{ button.label }} {{ button.points }}
            </button>
            {% endfor %}
        </form>
    </div>

    <div class="col-md-8">
        <h5>Add Custom Infraction</h5>
        <form method="POST" class="card p-3 shadow-sm">
            <div class="mb-3">
                <label class="form-label">Description</label>
                <input class="form-control" name="description" required />
            </div>

            <div class="mb-3">
                <label class="form-label">Point Value</label>
                <input class="form-control" type="number" name="points" required />
            </div>

            <button type="submit" class="btn btn-primary">Add Infraction</button>
        </form>
    </div>
</div>

{% endblock %}
